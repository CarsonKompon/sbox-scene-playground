@using Sandbox;
@using Sandbox.UI;
@inherits Panel

<root>
    <Image Texture=@RenderTexture style="width: 100%; height: 100%" />
</root>

@code
{
    public CameraComponent Camera { get; set; }

    Texture RenderTexture { get; set; }
    SceneCamera sceneCamera = new SceneCamera();

    public override void Tick()
    {
        if ( Camera is null ) return;

        // Update Camera
        var scene = Camera.GameObject.Scene;
        sceneCamera.World = scene.SceneWorld;
        sceneCamera.Worlds.Clear();
        sceneCamera.Worlds.Add( scene.DebugSceneWorld );
        sceneCamera.Position = Camera.Transform.Position;
        sceneCamera.Rotation = Camera.Transform.Rotation;
        sceneCamera.ZNear = Camera.ZNear;
        sceneCamera.ZFar = Camera.ZFar;
        sceneCamera.FieldOfView = Camera.FieldOfView;
        sceneCamera.BackgroundColor = Camera.BackgroundColor;
        sceneCamera.TargetEye = Camera.TargetEye;

        sceneCamera.Ortho = Camera.Orthographic;
        sceneCamera.OrthoHeight = Camera.OrthographicHeight;

        sceneCamera.VolumetricFog.Enabled = false;
        sceneCamera.Tonemap.Enabled = false;
        sceneCamera.CubemapFog.Enabled = false;
        sceneCamera.Bloom.Enabled = false;
    }

    public override void DrawBackground(ref RenderState state)
    {
        if( RenderTexture is null)
        {
            RenderTexture?.Dispose();
            RenderTexture = Texture.Create( 1024, 1024 ).Finish();
        }



        Graphics.RenderToTexture( sceneCamera, RenderTexture );
        Log.Info(RenderTexture);
    }

    protected override int BuildHash()
    {
        return HashCode.Combine(Time.Now);
    }

}